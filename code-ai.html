<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Code-AI-ML</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{--bg:#0d1117;--fg:#c9d1d9;--accent:#58a6ff;--ok:#3fb950;--bad:#f85149;--mono:ui-monospace,"Cascadia Code","Source Code Pro",Menlo,Consolas,monospace}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--fg);font-family:var(--mono);display:flex;flex-direction:column;height:100vh;font-size:14px;line-height:1.4}
header{padding:.5rem 1rem;border-bottom:1px solid var(--accent);display:flex;align-items:center;justify-content:space-between}
#screen{flex:1;display:flex;align-items:center;justify-content:center}
.card{background:#010409;border:1px solid var(--accent);border-radius:6px;padding:2rem;width:320px}
.card h2{margin-top:0;text-align:center}
.card button{width:100%;margin:.5rem 0;padding:.6rem;border:none;border-radius:4px;background:var(--accent);color:var(--bg);font-weight:bold;cursor:pointer}
.card input{width:100%;padding:.5rem;margin:.4rem 0;border:1px solid #30363d;border-radius:4px;background:#0d1117;color:var(--fg)}
label{font-size:.75rem}
.hidden{display:none}
#chat{flex:1;overflow:auto;padding:1rem}
#chat>div{margin:.4rem 0}
.user{color:var(--accent)}
.ai{color:var(--fg)}
pre{background:#010409;padding:.6rem;border-left:3px solid var(--accent);overflow-x:auto;margin:.3rem 0}
#box{display:flex;border-top:1px solid var(--accent)}
#msg{flex:1;border:none;padding:.7rem;background:transparent;color:var(--fg);outline:none;font-family:inherit}
#send{width:5rem;border:none;background:var(--accent);color:var(--bg);font-weight:bold;cursor:pointer}
#send:disabled{background:#484f58;cursor:not-allowed}
footer{text-align:center;font-size:.65rem;opacity:.6;padding:.3rem}
a{color:var(--accent)}
</style>
</head>
<body>
<header><span id="logo">Code-AI-ML</span><button id="logout" class="hidden">Logout</button></header>
<div id="loginScreen" class="card">
  <h2>Join Code-AI-ML</h2>
  <button id="googleBtn">ðŸ”‘ Sign in with Google</button>
  <hr style="border:none;border-top:1px solid #30363d;margin:1rem 0">
  <input id="phoneIn" type="tel" placeholder="+1 555 123 4567">
  <button id="phoneBtn">ðŸ“± Send SMS code</button>
  <input id="codeIn" placeholder="6-digit code" maxlength="6" class="hidden">
  <button id="verifyBtn" class="hidden">Verify code</button>
  <p id="loginError" style="color:var(--bad);font-size:.75rem;text-align:center"></p>
</div>
<div id="chatScreen" class="hidden">
  <div id="chat"></div>
  <form id="box">
    <input id="msg" placeholder="Describe what you needâ€¦" autocomplete="off" required>
    <button id="send">Send</button>
  </form>
</div>
<footer>Public-domain â€“ no rights reserved â€“ uses Firebase, TensorFlow.js, g4f</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
const firebaseConfig = {
  apiKey: "PASTE-YOURS",
  authDomain: "PASTE-YOURS",
  projectId: "PASTE-YOURS",
  storageBucket: "PASTE-YOURS",
  messagingSenderId: "PASTE-YOURS",
  appId: "PASTE-YOURS"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const googleProvider = new GoogleAuthProvider();
const $ = s => document.querySelector;
const loginScreen = $('#loginScreen');
const chatScreen = $('#chatScreen');
const googleBtn = $('#googleBtn');
const phoneBtn = $('#phoneBtn');
const phoneIn = $('#phoneIn');
const codeIn = $('#codeIn');
const verifyBtn = $('#verifyBtn');
const loginError = $('#loginError');
const logoutBtn = $('#logout');
const chatBox = $('#chat');
const input = $('#msg');
const sendBtn = $('#send');
const form = $('#box');
let currentConfirmationResult = null;

googleBtn.onclick = async () => { try { await signInWithPopup(auth, googleProvider); } catch (e) { loginError.textContent = e.message; } };
phoneBtn.onclick = async () => {
  const phone = phoneIn.value.trim(); if (!phone) return;
  try {
    window.recaptchaVerifier = new RecaptchaVerifier('phoneBtn', { size: 'invisible' }, auth);
    currentConfirmationResult = await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
    codeIn.classList.remove('hidden'); verifyBtn.classList.remove('hidden');
    loginError.textContent = 'Code sent â€“ check your phone';
  } catch (e) { loginError.textContent = e.message; }
};
verifyBtn.onclick = async () => { const code = codeIn.value; if (!code || !currentConfirmationResult) return; try { await currentConfirmationResult.confirm(code); } catch (e) { loginError.textContent = e.message; } };
logoutBtn.onclick = () => auth.signOut();
auth.onAuthStateChanged(user => {
  if (user) { loginScreen.classList.add('hidden'); chatScreen.classList.remove('hidden'); logoutBtn.classList.remove('hidden'); bootChat(); }
  else { loginScreen.classList.remove('hidden'); chatScreen.classList.add('hidden'); logoutBtn.classList.add('hidden'); }
});

async function bootChat() {
  const { Providers } = await import("https://cdn.jsdelivr.net/npm/g4f@latest/dist/g4f.esm.min.js");
  const provider = new Providers.ChatGPTProvider();
  let history = [], goal = '', mode = '', turn = 0;
  function add(who, html) {
    const d = document.createElement('div'); d.className = who;
    d.innerHTML = who === 'ai' ? html.replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>') : html.replace(/</g, '&lt;');
    chatBox.appendChild(d); chatBox.scrollTop = 1e9;
  }
  form.addEventListener('submit', async e => {
    e.preventDefault();
    const q = input.value.trim(); if (!q) return;
    input.value = ''; sendBtn.disabled = true; add('user', q); history.push({ role: 'user', content: q });
    const prompt = !goal
      ? `You are Code-AI-ML. Ask ONE short clarifying question so you understand what the code must accomplish (languages: C++, Python, MicroPython). History:\n${history.map(h => h.role + ': ' + h.content).join('\n')}`
      : `Goal: ${goal} (language: ${mode}). Write complete, runnable code and a short "Verification:" section. Wrap code blocks in triple backticks with language identifier.`;
    const reply = await provider.createCompletion([...history, { role: 'user', content: prompt }]);
    add('ai', reply); history.push({ role: 'assistant', content: reply });
    if (goal) { goal = ''; mode = ''; turn = 0; } else { turn++; }
    sendBtn.disabled = false; input.focus();
  });
  add('ai', 'Hi ðŸ‘‹ I write C++, Python or MicroPython. Tell me what you need and Iâ€™ll ask a few questions to make sure the code does exactly that.');
}
</script>
</body>
</html>